pipeline:
  maven:
    image: maven
    commands:
      - mkdir -p $HOME/.m2/
      - cp /secrets/settings.xml $HOME/.m2/
      - mvn clean package

  mount-cache:
    image: nexus.admin.sharecare.com/sso-scala-deps-cache:1.0
    commands:
      - cp -a /root/.ivy2 .
      - cp -a /root/.sbt .

  assemble:
    image: gempesaw/docker-sbt:0.13.11
    commands:
      - yes | cp -rf .ivy2/* /root/.ivy2/
      - yes | cp -rf .sbt/* /root/.sbt/
      - mkdir -p $HOME/.sbt/0.13/plugins/
      - cp /secrets/.credentials $HOME/.ivy2/
      - cp /secrets/credentials.sbt $HOME/.sbt/0.13/plugins/plugins.sbt
      - sbt

  gradle:
    image: nexus.admin.sharecare.com/sso-java-deps-cache:1.6
    commands:
      - echo "starting build step.."
      - export NEXUS_USERNAME=$(cat /secrets/username)
      - export NEXUS_PASSWORD=$(cat /secrets/password)
      - ./gradlew -PnexusUser=$NEXUS_USERNAME -PnexusPassword=$NEXUS_PASSWORD build --info
